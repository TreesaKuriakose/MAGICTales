<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Story</title>
	<style>
		:root {
			--bg-gradient: linear-gradient(135deg, #101820, #16222a, #0f2027);
			--text-color: #fff;
		}
		html, body {
			min-height: 100%;
			margin: 0;
			padding: 0;
			overflow-x: hidden;
		}
		body {
			width: 100vw;
			min-height: 100vh;
			background: var(--bg-gradient);
			display: flex;
			align-items: flex-start;
			justify-content: center;
			color: var(--text-color);
			padding: 20px 0;
		}
		#animation-bg {
			position: fixed;
			top: 0; left: 0; width: 100vw; height: 100vh;
			z-index: 0;
		}
		.container {
			position: relative;
			z-index: 1;
			max-width: 800px;
			margin: 0 auto;
			text-align: center;
			width: 100%;
		}
		.card { 
			border: 1px solid rgba(255, 255, 255, 0.2); 
			padding: 30px; 
			border-radius: 15px; 
			background: rgba(255, 255, 255, 0.05);
			backdrop-filter: blur(10px);
			margin-top: 20px;
		}
		.emotion { color: #00c6ff; }
		nav a { 
			margin-right: 15px; 
			color: #00c6ff;
			text-decoration: none;
			padding: 12px 24px;
			border-radius: 25px;
			background: rgba(0, 198, 255, 0.1);
			transition: background 0.3s;
			font-size: 1.1rem;
			font-weight: 500;
		}
		nav a:hover { background: rgba(0, 198, 255, 0.2); }
		h1 { 
			font-size: 2.5em;
			margin-bottom: 1em;
			text-shadow: 0 0 20px #00c6ff;
		}
		pre { 
			white-space: pre-wrap; 
			word-wrap: break-word; 
			text-align: left;
			background: rgba(0, 0, 0, 0.3);
			padding: 20px;
			border-radius: 10px;
			border-left: 4px solid #00c6ff;
			max-height: 500px;
			overflow-y: auto;
			line-height: 1.6;
		}
		.audio-controls {
			margin: 20px 0;
			padding: 20px;
			background: rgba(0, 198, 255, 0.1);
			border-radius: 10px;
			border: 1px solid rgba(0, 198, 255, 0.3);
		}
		.audio-btn {
			padding: 18px 36px;
			margin: 0 15px;
			background: #00c6ff;
			color: #fff;
			border: none;
			border-radius: 12px;
			cursor: pointer;
			transition: all 0.3s;
			font-size: 1.2rem;
			font-weight: 600;
		}
		.audio-btn:hover { background: #0072ff; }
		.audio-btn:disabled { 
			background: #666; 
			cursor: not-allowed; 
		}
		.audio-btn.playing { background: #ff6b6b; }
		.audio-btn.playing:hover { background: #ff5252; }
		.progress-bar {
			width: 100%;
			height: 8px;
			background: rgba(255, 255, 255, 0.2);
			border-radius: 4px;
			margin: 15px 0;
			overflow: hidden;
		}
		.progress-fill {
			height: 100%;
			background: #00c6ff;
			width: 0%;
			transition: width 0.1s;
		}
		.time-display {
			font-size: 0.9rem;
			color: rgba(255, 255, 255, 0.8);
			margin-top: 10px;
		}
	</style>
</head>
<body>
	<canvas id="animation-bg"></canvas>
	<div class="container">
		<nav>
			<a href="/">Home</a>
			<a href="/dashboard">Dashboard</a>
			<a href="/logout">Logout</a>
		</nav>
		<h1>Generated Story</h1>
		<div class="card">
			{% if emotion %}
				<p>Emotion: <strong class="emotion">{{ emotion }}</strong></p>
			{% else %}
				<p>No detected emotion yet. Go to the <a href="/dashboard">dashboard</a> and analyze an audio clip.</p>
			{% endif %}
			{% if story %}
				<div class="audio-controls">
					<h3>üéß Listen to Story</h3>
					<button id="playBtn" class="audio-btn">‚ñ∂Ô∏è Play</button>
					<button id="stopBtn" class="audio-btn" disabled>‚èπÔ∏è Stop</button>
					<div class="progress-bar">
						<div class="progress-fill" id="progressFill"></div>
					</div>
					<div class="time-display">
						<span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
					</div>
				</div>
				<pre>{{ story }}</pre>
			{% endif %}
		</div>
	</div>
	<script>
	// Animated particles background
	const canvas = document.getElementById('animation-bg');
	const ctx = canvas.getContext('2d');
	let width = window.innerWidth;
	let height = window.innerHeight;
	canvas.width = width;
	canvas.height = height;
	let particles = [];
	const numParticles = 80;
	
	function randomColor() {
		const colors = ['#00c6ff', '#0072ff', '#fff', '#2c5364'];
		return colors[Math.floor(Math.random() * colors.length)];
	}
	
	function createParticles() {
		particles = [];
		for (let i = 0; i < numParticles; i++) {
			particles.push({
				x: Math.random() * width,
				y: Math.random() * height,
				r: Math.random() * 2 + 1,
				dx: (Math.random() - 0.5) * 0.7,
				dy: (Math.random() - 0.5) * 0.7,
				color: randomColor()
			});
		}
	}
	
	function drawParticles() {
		ctx.clearRect(0, 0, width, height);
		for (let p of particles) {
			ctx.beginPath();
			ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
			ctx.fillStyle = p.color;
			ctx.globalAlpha = 0.7;
			ctx.fill();
			ctx.globalAlpha = 1.0;
			p.x += p.dx;
			p.y += p.dy;
			if (p.x < 0 || p.x > width) p.dx *= -1;
			if (p.y < 0 || p.y > height) p.dy *= -1;
		}
		requestAnimationFrame(drawParticles);
	}
	
	window.addEventListener('resize', () => {
		width = window.innerWidth;
		height = window.innerHeight;
		canvas.width = width;
		canvas.height = height;
		createParticles();
	});
	
	createParticles();
	drawParticles();
	
	// Audio functionality
	let speechSynthesis = window.speechSynthesis;
	let utterance = null;
	let isPlaying = false;
	let startTime = 0;
	let animationId = null;
	
	const playBtn = document.getElementById('playBtn');
	const stopBtn = document.getElementById('stopBtn');
	const progressFill = document.getElementById('progressFill');
	const currentTimeSpan = document.getElementById('currentTime');
	const totalTimeSpan = document.getElementById('totalTime');
	
	function formatTime(seconds) {
		const mins = Math.floor(seconds / 60);
		const secs = Math.floor(seconds % 60);
		return `${mins}:${secs.toString().padStart(2, '0')}`;
	}
	
	function updateProgress() {
		if (utterance && isPlaying) {
			const elapsed = (Date.now() - startTime) / 1000;
			const duration = utterance.text.length / 150; // Rough estimate: 150 chars per second
			const progress = Math.min((elapsed / duration) * 100, 100);
			
			progressFill.style.width = progress + '%';
			currentTimeSpan.textContent = formatTime(elapsed);
			totalTimeSpan.textContent = formatTime(duration);
			
			animationId = requestAnimationFrame(updateProgress);
		}
	}
	
	function speak() {
		if (speechSynthesis.speaking) {
			speechSynthesis.cancel();
		}
		
		const storyText = document.querySelector('pre').textContent;
		utterance = new SpeechSynthesisUtterance(storyText);
		utterance.rate = 0.9;
		utterance.pitch = 1.0;
		utterance.volume = 1.0;
		
		utterance.onstart = () => {
			isPlaying = true;
			startTime = Date.now();
			playBtn.textContent = '‚è∏Ô∏è Pause';
			playBtn.classList.add('playing');
			stopBtn.disabled = false;
			updateProgress();
		};
		
		utterance.onend = () => {
			isPlaying = false;
			playBtn.textContent = '‚ñ∂Ô∏è Play';
			playBtn.classList.remove('playing');
			stopBtn.disabled = true;
			progressFill.style.width = '0%';
			currentTimeSpan.textContent = '0:00';
			if (animationId) {
				cancelAnimationFrame(animationId);
			}
		};
		
		utterance.onpause = () => {
			isPlaying = false;
			playBtn.textContent = '‚ñ∂Ô∏è Play';
			playBtn.classList.remove('playing');
			if (animationId) {
				cancelAnimationFrame(animationId);
			}
		};
		
		utterance.onresume = () => {
			isPlaying = true;
			startTime = Date.now() - (parseFloat(currentTimeSpan.textContent.split(':')[0]) * 60 + parseFloat(currentTimeSpan.textContent.split(':')[1])) * 1000;
			playBtn.textContent = '‚è∏Ô∏è Pause';
			playBtn.classList.add('playing');
			updateProgress();
		};
		
		speechSynthesis.speak(utterance);
	}
	
	function pause() {
		if (speechSynthesis.speaking) {
			speechSynthesis.pause();
		}
	}
	
	function resume() {
		if (speechSynthesis.paused) {
			speechSynthesis.resume();
		}
	}
	
	function stop() {
		speechSynthesis.cancel();
		isPlaying = false;
		playBtn.textContent = '‚ñ∂Ô∏è Play';
		playBtn.classList.remove('playing');
		stopBtn.disabled = true;
		progressFill.style.width = '0%';
		currentTimeSpan.textContent = '0:00';
		if (animationId) {
			cancelAnimationFrame(animationId);
		}
	}
	
	playBtn.addEventListener('click', () => {
		if (isPlaying) {
			pause();
		} else {
			if (speechSynthesis.paused) {
				resume();
			} else {
				speak();
			}
		}
	});
	
	stopBtn.addEventListener('click', stop);
	</script>
</body>
</html>


